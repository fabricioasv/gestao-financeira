# üè¶ REGRAS DO CURSOR - Sistema de Gest√£o Financeira Pessoal

## üìã CONTEXTO DO PROJETO
Este √© um sistema de gest√£o financeira pessoal desenvolvido em Flask (Python) com frontend JavaScript modular ES6. O sistema gerencia dados financeiros, cart√µes de cr√©dito, investimentos e proventos atrav√©s de gr√°ficos interativos e tabelas filtradas.

## üèóÔ∏è ARQUITETURA DO PROJETO

### Estrutura de Arquivos
```
üìÅ static/js/
‚îú‚îÄ‚îÄ üìÑ app.js          ‚Üí M√≥dulo principal (orquestrador)
‚îú‚îÄ‚îÄ üìÑ charts.js       ‚Üí Funcionalidades de gr√°ficos (Chart.js)
‚îú‚îÄ‚îÄ üìÑ tables.js       ‚Üí Funcionalidades de tabelas e filtros
‚îú‚îÄ‚îÄ üìÑ utils.js        ‚Üí Fun√ß√µes utilit√°rias e helpers
‚îî‚îÄ‚îÄ üìÑ upload.js       ‚Üí Upload e processamento de arquivos Excel
```

### Padr√µes de M√≥dulos ES6
- ‚úÖ SEMPRE usar `export { ... }` no final do arquivo
- ‚ùå NUNCA usar `export function` inline
- ‚úÖ Importar apenas o que √© necess√°rio
- ‚úÖ Manter depend√™ncias circulares m√≠nimas

## üé® PADR√ïES DE C√ìDIGO

### 1. Nomenclatura
```javascript
// ‚úÖ Fun√ß√µes: camelCase descritivo
createProventosChart()
populateCartaoFilters()
filtrarCartaoDetalhe()

// ‚úÖ Vari√°veis: camelCase descritivo
cartaoDetalheData
originalCartaoData
dadosFiltrados

// ‚úÖ Constantes: UPPER_SNAKE_CASE
const MAX_ITEMS = 100;
const DEFAULT_FILTER = 'desde-inicio';
```

### 2. Estrutura de Fun√ß√µes
```javascript
function nomeDaFuncao(parametros) {
    // 1. Log de in√≠cio com emoji
    console.log('üöÄ nomeDaFuncao INICIADA');
    
    // 2. Valida√ß√£o de par√¢metros
    if (!parametros) {
        logError('‚ùå Par√¢metros inv√°lidos');
        return;
    }
    
    // 3. L√≥gica principal
    const resultado = processarDados(parametros);
    
    // 4. Log de resultado
    logDebug('‚úÖ Resultado:', resultado);
    
    // 5. Retorno
    return resultado;
}
```

### 3. Sistema de Logs (OBRIGAT√ìRIO)
```javascript
// ‚úÖ SEMPRE usar para debug
console.log('üöÄ Fun√ß√£o INICIADA');
logDebug('üîç Dados recebidos:', dados);
logError('‚ùå Erro encontrado:', erro);

// ‚úÖ Padr√£o de emojis para identifica√ß√£o r√°pida
üöÄ = In√≠cio de fun√ß√£o
üîç = Debug/Investiga√ß√£o
‚úÖ = Sucesso
‚ùå = Erro
‚ö†Ô∏è = Aviso
```

## üîß REGRAS T√âCNICAS

### 1. Valida√ß√£o de Dados
```javascript
// ‚úÖ SEMPRE validar antes de usar
if (!Array.isArray(dados)) {
    logError('‚ùå Dados n√£o s√£o um array:', dados);
    return;
}

if (dados.length === 0) {
    logDebug('‚ö†Ô∏è Dados vazios');
    return;
}

// ‚úÖ Usar validateElement para elementos DOM
const elemento = validateElement('idElemento', 'nomeFuncao');
if (!elemento) return;
```

### 2. Compartilhamento Global
```javascript
// ‚úÖ Expor fun√ß√µes necess√°rias para HTML
window.minhaFuncao = minhaFuncao;

// ‚úÖ Armazenar dados globais
window.originalData = data;

// ‚úÖ Verificar disponibilidade antes de usar
if (window.minhaFuncao) {
    window.minhaFuncao();
}
```

### 3. Tratamento de Gr√°ficos
```javascript
// ‚úÖ SEMPRE destruir gr√°ficos antes de recriar
if (meuGrafico) {
    meuGrafico.destroy();
}

// ‚úÖ Validar dados antes de criar gr√°fico
if (!Array.isArray(dados) || dados.length === 0) {
    logDebug('‚ö†Ô∏è Dados insuficientes para gr√°fico');
    return;
}
```

### 4. Filtros e Dados
```javascript
// ‚úÖ Usar Set para valores √∫nicos
const valoresUnicos = [...new Set(array)];

// ‚úÖ Filtrar antes de processar
const dadosFiltrados = dadosOriginais.filter(condicao);

// ‚úÖ Manter dados originais para filtros
window.originalData = data;
```

## üìä FUNCIONALIDADES ESPEC√çFICAS

### 1. Filtros de Proventos
- ‚úÖ Suportar: 'desde-inicio', 'este-ano', 'ultimos-12-meses'
- ‚úÖ Atualizar tanto gr√°fico quanto tabela
- ‚úÖ Usar dados globais compartilhados

### 2. Filtros de Cart√£o
- ‚úÖ Filtros por m√™s e grupo
- ‚úÖ Atualizar tabela detalhada
- ‚úÖ Atualizar gr√°fico de categorias
- ‚úÖ Manter estrutura de dados original

### 3. Gr√°ficos
- ‚úÖ Usar Chart.js para todos os gr√°ficos
- ‚úÖ Responsivos e interativos
- ‚úÖ Cores consistentes e acess√≠veis
- ‚úÖ Tooltips formatados em portugu√™s

## üö´ O QUE N√ÉO FAZER

### 1. Imports/Exports
```javascript
// ‚ùå NUNCA fazer isso
export function minhaFuncao() { /* ... */ }
export { minhaFuncao }; // Duplica√ß√£o!

// ‚ùå NUNCA importar o que n√£o √© usado
import { funcaoNaoUsada } from './modulo.js';
```

### 2. Dados Globais
```javascript
// ‚ùå NUNCA sobrescrever dados globais sem verificar
window.dados = novosDados; // Pode quebrar outras funcionalidades

// ‚ùå NUNCA acessar dados sem validar
dados.propriedade.metodo(); // Pode causar erro
```

### 3. Elementos DOM
```javascript
// ‚ùå NUNCA acessar elementos sem validar
document.getElementById('id').innerHTML = ''; // Pode falhar

// ‚ùå NUNCA assumir que elementos existem
elemento.style.display = 'block'; // Pode causar erro
```

## üéØ REGRAS DE DEBUGGING

### 1. Logs Obrigat√≥rios
- ‚úÖ SEMPRE logar in√≠cio de fun√ß√µes cr√≠ticas
- ‚úÖ SEMPRE logar dados recebidos
- ‚úÖ SEMPRE logar resultados de opera√ß√µes
- ‚úÖ SEMPRE logar erros com contexto

### 2. Valida√ß√£o de Dados
- ‚úÖ SEMPRE validar tipo de dados
- ‚úÖ SEMPRE validar exist√™ncia de propriedades
- ‚úÖ SEMPRE validar elementos DOM
- ‚úÖ SEMPRE validar par√¢metros de fun√ß√£o

### 3. Tratamento de Erros
- ‚úÖ SEMPRE usar try-catch para opera√ß√µes cr√≠ticas
- ‚úÖ SEMPRE logar erros com detalhes
- ‚úÖ SEMPRE retornar valores seguros em caso de erro
- ‚úÖ SEMPRE verificar disponibilidade de fun√ß√µes globais

## üîç EXEMPLOS DE IMPLEMENTA√á√ÉO

### 1. Nova Fun√ß√£o de Gr√°fico
```javascript
function createNovoGrafico(dados) {
    console.log('üöÄ createNovoGrafico INICIADA');
    logDebug('üîç Dados recebidos:', dados);
    
    // Valida√ß√£o
    if (!Array.isArray(dados) || dados.length === 0) {
        logError('‚ùå Dados inv√°lidos para gr√°fico');
        return;
    }
    
    // L√≥gica principal
    const canvas = validateElement('canvasId', 'createNovoGrafico');
    if (!canvas) return;
    
    // Criar gr√°fico
    const grafico = new Chart(canvas.getContext('2d'), config);
    
    logDebug('‚úÖ Gr√°fico criado com sucesso');
    return grafico;
}
```

### 2. Nova Fun√ß√£o de Filtro
```javascript
function aplicarNovoFiltro(tipo, dados) {
    console.log('üöÄ aplicarNovoFiltro INICIADA');
    logDebug('üîç Filtro:', tipo, 'Dados:', dados);
    
    // Valida√ß√£o
    if (!dados || !Array.isArray(dados)) {
        logError('‚ùå Dados inv√°lidos para filtro');
        return [];
    }
    
    // Aplicar filtro
    const dadosFiltrados = dados.filter(item => {
        // L√≥gica de filtro
        return condicao;
    });
    
    logDebug('‚úÖ Filtro aplicado:', dadosFiltrados.length, 'itens');
    return dadosFiltrados;
}
```

## üìù CHECKLIST PARA NOVAS FUNCIONALIDADES

### Antes de Implementar
- [ ] Verificar se j√° existe fun√ß√£o similar
- [ ] Definir estrutura de dados necess√°ria
- [ ] Planejar logs e valida√ß√µes
- [ ] Verificar depend√™ncias e imports

### Durante Implementa√ß√£o
- [ ] Seguir padr√£o de nomenclatura
- [ ] Implementar logs obrigat√≥rios
- [ ] Adicionar valida√ß√µes robustas
- [ ] Manter compatibilidade com sistema existente

### Ap√≥s Implementa√ß√£o
- [ ] Testar com dados reais
- [ ] Verificar logs no console
- [ ] Testar cen√°rios de erro
- [ ] Documentar funcionalidade

## üéØ PRIORIDADES DE DESENVOLVIMENTO

### Alta Prioridade
1. **Corre√ß√£o de bugs** - Sempre primeiro
2. **Funcionalidades core** - Filtros, gr√°ficos, tabelas
3. **Valida√ß√£o de dados** - Seguran√ßa e estabilidade

### M√©dia Prioridade
1. **Melhorias de UX** - Interface e usabilidade
2. **Performance** - Otimiza√ß√µes e cache
3. **Funcionalidades avan√ßadas** - Export, compara√ß√µes

### Baixa Prioridade
1. **Refatora√ß√£o** - Limpeza de c√≥digo
2. **Documenta√ß√£o** - Coment√°rios e docs
3. **Testes** - Cobertura e valida√ß√£o

---

## üöÄ LEMBRE-SE
- **SEMPRE** seguir os padr√µes estabelecidos
- **SEMPRE** implementar logs detalhados
- **SEMPRE** validar dados e elementos
- **SEMPRE** manter compatibilidade com sistema existente
- **SEMPRE** testar antes de considerar conclu√≠do

**Estas regras garantem c√≥digo consistente, manuten√≠vel e de alta qualidade!** üéØ
